# Terraform-1

# Terraform 練習用構成の説明

このリポジトリは、Terraformを使ってAWS上に簡単なVPCネットワークとEC2インスタンスを作成する練習用の構成です。
モジュール（module）を使って「ネットワーク部分」と「コンピュート（EC2インスタンス）部分」を分け、再利用性や管理のしやすさを高める設計にしています。

以下に各ファイルとディレクトリの役割、および設定の意図を説明します。

------------------------------------------------------------
■ ルートディレクトリのファイル

1. provider.tf

Terraformで使用するプロバイダー（今回はAWS）を定義しています。
具体的にはAWSプロバイダーのバージョンを指定し（例：~> 6.0）、将来のバージョン違いによる不具合を防ぐようにしています。
また、使用するリージョン（ap-northeast-1：東京リージョン）を指定し、全リソースに共通のタグ（Pj、Owner、Env）を自動付与するよう設定しています。
これにより、後からAWSコンソールでリソースを確認するときに、プロジェクトや環境ごとにリソースを識別しやすくなります。

2. main.tf

ルートモジュールとして、networkモジュールとcomputeモジュールを呼び出しています。
networkモジュールではVPC、サブネット、インターネットゲートウェイ、ルートテーブル、セキュリティグループを作成します。
computeモジュールではEC2インスタンスを作成します。
値（例えばVPCのCIDRやAMI ID）はmain.tf内に直接記述しており、練習用のシンプルな構成にしています。
なお、instance_typeはcomputeモジュール側でデフォルト値（t2.micro）が設定されているため、省略可能としています。

------------------------------------------------------------
■ modules/network ディレクトリ

ネットワーク構成を担当するモジュールです。

1. main.tf

VPC、複数のパブリックサブネット、インターネットゲートウェイ、ルートテーブル、セキュリティグループを作成します。
サブネットはfor_eachを使用し、map型の入力値から複数生成できるようにしています。
セキュリティグループではHTTP（80番）とHTTPS（443番）のインバウンド、および全アウトバウンド通信を許可しています。
練習用のため全開放にしていますが、実務では最小限の許可設定にとどめるべきです。

2. variables.tf

VPCのCIDRブロック、およびサブネット情報（CIDRとアベイラビリティゾーンのセット）を受け取る変数を定義しています。
サブネット情報はmap(object)型で設計しており、柔軟に複数サブネットを定義できるようにしています。

3. output.tf

作成したVPCのID、パブリックサブネットのIDリスト、セキュリティグループのID、ルートテーブルのIDを呼び出し元（ルートモジュール）に渡しています。
outputにすることで、後続のモジュール（例えばcomputeモジュール）や外部ツールでこれらの値を再利用できるようになります。

------------------------------------------------------------
■ modules/compute ディレクトリ

EC2インスタンスを担当するモジュールです。

1. main.tf

1台のEC2インスタンスを作成します。
受け取ったサブネットID（リストの先頭の1つを使用）、セキュリティグループID、AMI ID、キーペア名、インスタンスタイプ、インスタンス名タグを使ってリソースを作成します。
将来的に複数台作成に対応する場合は、countやfor_eachを追加することで拡張が可能です。

2. variables.tf

AMI ID、インスタンスタイプ（デフォルト値つき）、サブネットIDリスト、セキュリティグループID、キーペア名、インスタンス名を受け取る変数を定義しています。
デフォルト値を設定することで、呼び出し元が明示的に指定しなくても動作する部分（例えばインスタンスタイプ）を柔軟にしています。

3. output.tf

作成したEC2インスタンスのID、パブリックIP、プライベートIPを呼び出し元に渡しています。
これにより、例えば作成後にterraform outputコマンドでインスタンスの接続先IPを確認できるようになります。

------------------------------------------------------------
■ 注意事項

この構成はあくまで練習用であり、特にセキュリティグループの設定（全開放）は実務には適しません。
実際のプロジェクトでは、必要最小限の開放範囲に留めるよう注意してください。

また、値をmain.tfに直接記述していますが、より柔軟な設計を目指す場合はルートモジュール側にvariables.tfやterraform.tfvarsを追加し、環境や用途ごとに切り替えられるようにすることをおすすめします。

------------------------------------------------------------
■ まとめ

このプロジェクトは、Terraformの基礎（モジュール分割、変数、output、module間連携）を学ぶのに適したシンプルな構成です。
一通り理解・実行した後は、ぜひ複数環境対応、複数インスタンス対応、セキュリティ強化といった発展にチャレンジしてみてください。


